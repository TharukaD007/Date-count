<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Study Hours Tracker - Multi User</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        .subtitle {
            color: #666;
            margin-bottom: 25px;
        }
        
        /* Profile Section */
        .profile-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }
        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .current-user {
            font-size: 1.2em;
            font-weight: 600;
            color: #667eea;
        }
        .profile-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }
        .close:hover {
            color: #000;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        input[type="text"],
        input[type="date"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        /* Button Styles */
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }
        
        /* Data Entry Section */
        .data-entry {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }
        .input-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .input-row input {
            flex: 1;
            min-width: 150px;
        }
        
        /* Stats Section */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        /* User List */
        .user-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .user-item {
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        .user-item:hover {
            background: #e9ecef;
        }
        .user-item.active {
            background: #667eea;
            color: white;
        }
        
        /* Chart */
        canvas {
            margin-top: 20px;
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“š Daily Study Hours Tracker</h1>
        <p class="subtitle">Track your daily study hours until August 1, 2026</p>

        <!-- Profile Section -->
        <div class="profile-section">
            <div class="profile-header">
                <div class="current-user" id="currentUserDisplay">No user selected</div>
                <div class="profile-actions">
                    <button class="btn-primary btn-small" onclick="showProfileModal()">Switch Profile</button>
                    <button class="btn-secondary btn-small" onclick="showNewUserModal()">New Profile</button>
                </div>
            </div>
        </div>

        <!-- Data Entry Section -->
        <div class="data-entry" id="dataEntrySection" style="display: none;">
            <h3>Add Study Session</h3>
            <div class="input-row">
                <input type="date" id="dateInput">
                <input type="number" id="hoursInput" placeholder="Study Hours" min="0" max="24" step="0.5">
                <button class="btn-primary" onclick="addEntry()">Add / Update</button>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats" id="statsSection" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="totalHours">0</div>
                <div class="stat-label">Total Hours</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgHours">0</div>
                <div class="stat-label">Avg Hours/Day</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="daysLogged">0</div>
                <div class="stat-label">Days Logged</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="daysRemaining">0</div>
                <div class="stat-label">Days Until Goal</div>
            </div>
        </div>

        <!-- Chart -->
        <canvas id="studyChart" style="display: none;"></canvas>
    </div>

    <!-- Profile Selection Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProfileModal()">&times;</span>
            <h2>Select Profile</h2>
            <div class="user-list" id="userList"></div>
        </div>
    </div>

    <!-- New User Modal -->
    <div id="newUserModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeNewUserModal()">&times;</span>
            <h2>Create New Profile</h2>
            <div class="form-group">
                <label for="newUserName">Name</label>
                <input type="text" id="newUserName" placeholder="Enter your name">
            </div>
            <div class="form-group">
                <label for="newUserEmail">Email (optional)</label>
                <input type="text" id="newUserEmail" placeholder="Enter your email">
            </div>
            <button class="btn-primary" onclick="createNewUser()">Create Profile</button>
        </div>
    </div>

    <script>
        // IndexedDB Setup
        const DB_NAME = 'StudyTrackerDB';
        const DB_VERSION = 1;
        let db;
        let currentUser = null;

        // Initialize Database
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };

                request.onupgradeneeded = (event) => {
                    db = event.target.result;

                    // Create users store
                    if (!db.objectStoreNames.contains('users')) {
                        const userStore = db.createObjectStore('users', { keyPath: 'id', autoIncrement: true });
                        userStore.createIndex('name', 'name', { unique: false });
                        userStore.createIndex('email', 'email', { unique: false });
                    }

                    // Create study data store
                    if (!db.objectStoreNames.contains('studyData')) {
                        const dataStore = db.createObjectStore('studyData', { keyPath: ['userId', 'date'] });
                        dataStore.createIndex('userId', 'userId', { unique: false });
                    }
                };
            });
        }

        // User Management
        function createUser(name, email) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['users'], 'readwrite');
                const store = transaction.objectStore('users');
                const user = {
                    name: name,
                    email: email || '',
                    createdAt: new Date().toISOString()
                };
                const request = store.add(user);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        function getAllUsers() {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['users'], 'readonly');
                const store = transaction.objectStore('users');
                const request = store.getAll();
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        function getUser(userId) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['users'], 'readonly');
                const store = transaction.objectStore('users');
                const request = store.get(userId);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // Study Data Management
        function saveStudyEntry(userId, date, hours) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['studyData'], 'readwrite');
                const store = transaction.objectStore('studyData');
                const entry = { userId, date, hours };
                const request = store.put(entry);
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        function getUserStudyData(userId) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['studyData'], 'readonly');
                const store = transaction.objectStore('studyData');
                const index = store.index('userId');
                const request = index.getAll(userId);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // Chart Setup
        const ctx = document.getElementById('studyChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Study Hours',
                    data: [],
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Hours'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true
                    }
                }
            }
        });

        // UI Functions
        async function loadUserData(userId) {
            currentUser = await getUser(userId);
            localStorage.setItem('lastUserId', userId);
            
            document.getElementById('currentUserDisplay').textContent = `ðŸ‘¤ ${currentUser.name}`;
            document.getElementById('dataEntrySection').style.display = 'block';
            document.getElementById('statsSection').style.display = 'grid';
            document.getElementById('studyChart').style.display = 'block';
            
            const studyData = await getUserStudyData(userId);
            updateChart(studyData);
            updateStats(studyData);
            
            // Set default date to today
            document.getElementById('dateInput').valueAsDate = new Date();
        }

        function updateChart(studyData) {
            const sortedData = studyData.sort((a, b) => new Date(a.date) - new Date(b.date));
            chart.data.labels = sortedData.map(entry => entry.date);
            chart.data.datasets[0].data = sortedData.map(entry => entry.hours);
            chart.update();
        }

        function updateStats(studyData) {
            const totalHours = studyData.reduce((sum, entry) => sum + entry.hours, 0);
            const daysLogged = studyData.length;
            const avgHours = daysLogged > 0 ? (totalHours / daysLogged).toFixed(1) : 0;
            
            const endDate = new Date('2026-08-01');
            const today = new Date();
            const daysRemaining = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
            
            document.getElementById('totalHours').textContent = totalHours.toFixed(1);
            document.getElementById('avgHours').textContent = avgHours;
            document.getElementById('daysLogged').textContent = daysLogged;
            document.getElementById('daysRemaining').textContent = daysRemaining;
        }

        async function addEntry() {
            if (!currentUser) {
                alert('Please select a profile first');
                return;
            }

            const date = document.getElementById('dateInput').value;
            const hours = parseFloat(document.getElementById('hoursInput').value);

            if (!date || isNaN(hours)) {
                alert('Please enter both date and hours');
                return;
            }

            const endDate = new Date('2026-08-01');
            if (new Date(date) > endDate) {
                alert('Date must be before August 1, 2026');
                return;
            }

            if (hours < 0 || hours > 24) {
                alert('Hours must be between 0 and 24');
                return;
            }

            await saveStudyEntry(currentUser.id, date, hours);
            const studyData = await getUserStudyData(currentUser.id);
            updateChart(studyData);
            updateStats(studyData);

            document.getElementById('hoursInput').value = '';
            alert('Entry saved successfully!');
        }

        // Modal Functions
        async function showProfileModal() {
            const users = await getAllUsers();
            const userList = document.getElementById('userList');
            userList.innerHTML = '';

            if (users.length === 0) {
                userList.innerHTML = '<p style="text-align: center; color: #666;">No profiles found. Create one to get started!</p>';
            } else {
                users.forEach(user => {
                    const div = document.createElement('div');
                    div.className = 'user-item' + (currentUser && user.id === currentUser.id ? ' active' : '');
                    div.innerHTML = `
                        <div>
                            <strong>${user.name}</strong>
                            ${user.email ? `<br><small style="opacity: 0.7;">${user.email}</small>` : ''}
                        </div>
                    `;
                    div.onclick = () => {
                        loadUserData(user.id);
                        closeProfileModal();
                    };
                    userList.appendChild(div);
                });
            }

            document.getElementById('profileModal').style.display = 'block';
        }

        function closeProfileModal() {
            document.getElementById('profileModal').style.display = 'none';
        }

        function showNewUserModal() {
            document.getElementById('newUserModal').style.display = 'block';
        }

        function closeNewUserModal() {
            document.getElementById('newUserModal').style.display = 'none';
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserEmail').value = '';
        }

        async function createNewUser() {
            const name = document.getElementById('newUserName').value.trim();
            const email = document.getElementById('newUserEmail').value.trim();

            if (!name) {
                alert('Please enter a name');
                return;
            }

            const userId = await createUser(name, email);
            closeNewUserModal();
            await loadUserData(userId);
            alert(`Profile created for ${name}!`);
        }

        // Initialize App
        async function initApp() {
            await initDB();
            
            // Check for last used user
            const lastUserId = parseInt(localStorage.getItem('lastUserId'));
            if (lastUserId) {
                try {
                    await loadUserData(lastUserId);
                } catch (error) {
                    console.log('Last user not found, showing profile selection');
                    showProfileModal();
                }
            } else {
                showProfileModal();
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }

        // Start the app
        initApp();
    </script>
</body>
</html>
